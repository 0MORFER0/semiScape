<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>El Telescopio de las Estrellas</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: black;
            color: white;
            overflow: hidden;
            text-align: center;
        }
        canvas {
            position: absolute;
            top: 0;
            left: 0;
        }
        .container {
            position: relative;
            z-index: 2;
            max-width: 90%;
        }
        h1 {
            font-size: 2rem;
            margin-bottom: 1rem;
            transition: all 1s ease-in-out;
        }
        p {
            font-size: 1.2rem;
            margin-bottom: 1.5rem;
        }
        .popup {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 20px;
            border-radius: 10px;
            display: none;
            text-align: center;
        }
        .popup img {
            max-width: 100%;
            height: auto;
        }
        #centralPoint {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: red;
            border-radius: 50%;
            z-index: 5;
        }
        #status {
            position: fixed;
            top: 10px;
            width: 100%;
            font-size: 1.2rem;
            text-align: center;
            z-index: 10;
        }
    </style>
</head>
<body>
    <canvas id="starCanvas"></canvas>
    <div class="container">
        <h1 id="title">El Telescopio de las Estrellas</h1>
        <p id="introText">Usa tu móvil para explorar las estrellas y encontrar las 3 constelaciones ocultas. Solo tienes 3 intentos por estrella.</p>
    </div>
    <div id="popup" class="popup">
        <h2 id="constellationName"></h2>
        <img id="constellationImage" src="" alt="Constelación">
    </div>
    <div id="centralPoint"></div>
    <div id="status">Intentos restantes: 3</div>

    <script>
        const canvas = document.getElementById('starCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const popup = document.getElementById('popup');
        const constellationName = document.getElementById('constellationName');
        const constellationImage = document.getElementById('constellationImage');
        const introText = document.getElementById('introText');
        const statusText = document.getElementById('status');

        const stars = [];
        const starCount = 1000; // Aumentamos el número de estrellas
        const targetStars = [];
        const constellations = [
            { name: "Orión", image: "https://example.com/orion.jpg" },
            { name: "Casiopea", image: "https://example.com/cassiopeia.jpg" },
            { name: "Andrómeda", image: "https://example.com/andromeda.jpg" }
        ];
        let attemptsLeft = 3;
        let foundCount = 0;

        // Crear más estrellas
        for (let i = 0; i < starCount; i++) {
            stars.push({
                x: Math.random() * 360,
                y: Math.random() * 360,
                size: Math.random() * 2 + 1,
                color: 'white',
                unique: false
            });
        }

        // Asignar las 3 estrellas objetivo
        while (targetStars.length < 3) {
            const index = Math.floor(Math.random() * stars.length);
            if (!stars[index].unique) {
                stars[index].unique = true;
                stars[index].color = 'blue';  // Estrellas objetivo en azul
                stars[index].size = stars[index].size * 3; // Hacerlas 3 veces más grandes
                targetStars.push(stars[index]);
            }
        }

        function drawStars(alpha, beta, gamma) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            stars.forEach(star => {
                const x = (canvas.width / 2) + (star.x - alpha) * 10;
                const y = (canvas.height / 2) + (star.y - beta) * 10;

                if (x > 0 && x < canvas.width && y > 0 && y < canvas.height) {
                    ctx.fillStyle = star.color;
                    ctx.beginPath();
                    ctx.arc(x, y, star.size, 0, Math.PI * 2);
                    ctx.fill();
                }
            });

            // Dibujar el punto central una sola vez
            ctx.fillStyle = 'red';
            ctx.beginPath();
            ctx.arc(canvas.width / 2, canvas.height / 2, 5, 0, Math.PI * 2);
            ctx.fill();
        }

        function showPopup(constellation) {
            constellationName.textContent = constellation.name;
            constellationImage.src = constellation.image;
            popup.style.display = 'block';

            setTimeout(() => {
                popup.style.display = 'none';
                attemptsLeft = 3;
                statusText.textContent = `Intentos restantes: ${attemptsLeft}`;

                if (foundCount === 3) {
                    statusText.textContent = '¡Has encontrado todas las constelaciones!';
                }
            }, 6000);
        }

        function handleTouch(event) {
            if (attemptsLeft <= 0 || foundCount === 3) return;

            const touchX = event.touches[0].clientX;
            const touchY = event.touches[0].clientY;

            const found = targetStars.some((targetStar, index) => {
                const targetX = (canvas.width / 2) + (targetStar.x - currentAlpha) * 10;
                const targetY = (canvas.height / 2) + (targetStar.y - currentBeta) * 10;
                const distance = Math.sqrt((touchX - targetX) ** 2 + (touchY - targetY) ** 2);

                if (distance < 20) {
                    showPopup(constellations[index]);
                    targetStars.splice(index, 1);
                    foundCount++;
                    return true;
                }
                return false;
            });

            if (!found) {
                attemptsLeft--;
                if (attemptsLeft > 0) {
                    statusText.textContent = `Intentos restantes: ${attemptsLeft}`;
                } else {
                    statusText.textContent = '¡Te quedaste sin intentos!';
                    statusText.style.color = 'red';
                }
            }
        }

        let currentAlpha = 0;
        let currentBeta = 0;
        let currentGamma = 0;

        if (window.DeviceOrientationEvent) {
            window.addEventListener('deviceorientation', (event) => {
                // Corregir la orientación (invertir los valores)
                currentAlpha = -event.alpha || 0;  // Invertir la dirección de la rotación horizontal
                currentBeta = -event.beta || 0;    // Invertir la dirección de la rotación vertical
                currentGamma = event.gamma || 0;
                drawStars(currentAlpha, currentBeta, currentGamma);
            });
        } else {
            statusText.textContent = 'Tu dispositivo no soporta detección de orientación.';
        }

        canvas.addEventListener('touchstart', handleTouch);

        // Texto inicial desaparece después de 5 segundos
        setTimeout(() => {
            document.getElementById('title').style.display = 'none';
            document.getElementById('introText').style.display = 'none';
        }, 5000);
    </script>
</body>
</html>
