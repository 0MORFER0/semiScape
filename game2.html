<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Juego 2 - Escape Room</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      margin: 0;
      padding: 0;
      background: linear-gradient(120deg, #8e44ad, #3498db);
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      position: relative;
    }
    .user-info {
      position: absolute;
      top: 10px;
      right: 20px;
      background: rgba(0, 0, 0, 0.5);
      padding: 10px 20px;
      border-radius: 10px;
      font-size: 16px;
    }
    .user-info button {
      margin-left: 10px;
      background-color: #e74c3c;
      border: none;
      color: white;
      padding: 5px 10px;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    .user-info button:hover {
      background-color: #c0392b;
    }
    .container {
      text-align: center;
      width: 90%;
      max-width: 600px;
    }
    h1 {
      font-size: 2.5em;
      margin-bottom: 20px;
    }
    .enigma {
      margin-top: 30px;
      padding: 20px;
      background: rgba(0, 0, 0, 0.5);
      border-radius: 10px;
      text-align: left;
    }
    .enigma h2 {
      font-size: 1.5em;
      margin-bottom: 10px;
    }
    .color-buttons {
      display: flex;
      justify-content: space-around;
      margin-bottom: 20px;
    }
    .color-buttons button {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      border: none;
      cursor: pointer;
      opacity: 0.7;
      transition: opacity 0.3s ease;
    }
    .color-buttons button:hover {
      opacity: 1;
    }
    #feedback {
      color: yellow;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div class="user-info" id="user-info"></div>
  <div class="container">
    <h1>Juego 2: El Desafío de Colores</h1>
    <div class="enigma" id="enigma">
      <h2>Recuerda las combinaciones de colores</h2>
      <p>Los botones de colores se iluminarán en un orden aleatorio. Tu tarea es replicar ese orden de colores. ¡Buena suerte!</p>

      <div class="color-buttons">
        <button id="btn1" style="background-color: red;"></button>
        <button id="btn2" style="background-color: green;"></button>
        <button id="btn3" style="background-color: blue;"></button>
        <button id="btn4" style="background-color: yellow;"></button>
        <button id="btn5" style="background-color: orange;"></button>
        <button id="btn6" style="background-color: purple;"></button>
      </div>

      <button id="start" onclick="startRound()">Iniciar Ronda</button>
      <p id="feedback"></p>
    </div>
  </div>

  <script>
    // Verificar que el usuario está autenticado
    window.onload = function() {
      const username = sessionStorage.getItem("userName");
      if (!username) {
        alert("Debes iniciar sesión primero.");
        window.location.href = 'login.html'; // Redirige si no hay sesión
      } else {
        document.getElementById('user-info').textContent = `Usuario: ${username}`;
      }
    };

    const colors = ['red', 'green', 'blue', 'yellow', 'orange', 'purple'];
    let sequence = [];
    let userSequence = [];
    let round = 1;

    // Función para empezar una nueva ronda
    function startRound() {
      userSequence = [];
      document.getElementById("feedback").textContent = "";
      if (round > 4) {
        document.getElementById("feedback").textContent = "¡Has completado todas las rondas! ¡Felicidades!";
        return;
      }

      // Generar una secuencia aleatoria de colores
      sequence.push(colors[Math.floor(Math.random() * colors.length)]);

      // Mostrar la secuencia de colores
      displaySequence();
    }

    // Función para mostrar la secuencia
    function displaySequence() {
      let index = 0;
      const buttons = document.querySelectorAll(".color-buttons button");

      // Desactivar el botón de iniciar mientras se muestra la secuencia
      document.getElementById("start").disabled = true;

      const interval = setInterval(() => {
        buttons.forEach(button => button.style.opacity = 0.7); // Restablecer opacidad

        // Resaltar el color en la secuencia
        buttons.forEach(button => {
          if (button.style.backgroundColor === sequence[index]) {
            button.style.opacity = 1;
          }
        });

        index++;

        if (index === sequence.length) {
          clearInterval(interval);
          setTimeout(() => {
            // Habilitar los botones para que el usuario intente replicar la secuencia
            document.getElementById("start").disabled = false;
          }, 500);
        }
      }, 1000);
    }

    // Función para manejar los clics de los botones de colores
    document.querySelectorAll(".color-buttons button").forEach((button, idx) => {
      button.addEventListener("click", () => {
        if (userSequence.length < sequence.length) {
          userSequence.push(button.style.backgroundColor);

          // Verificar si la secuencia del usuario es correcta
          if (userSequence.length === sequence.length) {
            verifySequence();
          }
        }
      });
    });

    // Función para verificar si la secuencia del usuario es correcta
    function verifySequence() {
      if (userSequence.join(',') === sequence.join(',')) {
        document.getElementById("feedback").textContent = "¡Correcto! Has pasado esta ronda.";
        document.getElementById("feedback").style.color = "lime";

        // Incrementar la ronda
        round++;
        setTimeout(startRound, 2000); // Empezar la siguiente ronda
      } else {
        document.getElementById("feedback").textContent = "Secuencia incorrecta. Intenta de nuevo.";
        document.getElementById("feedback").style.color = "red";
      }
    }
  </script>
</body>
</html>
