<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Juego 3 - Cuestionario</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
</head>
<script src="checkPageStatus.js" defer></script>
<body>
  <div class="user-info" id="user-info"></div>
  <div class="container">
    <h1>Juego 3: Cuestionario por Parejas</h1>
    
    <div id="cuestionario">
      <!-- Preguntas dinámicas aquí -->
    </div>

    <div id="feedback" style="margin-top: 20px;"></div>
  </div>

  <script src="config.js"></script>
  <script>
    // Preguntas y respuestas
    const preguntas = [
      { id: 1, texto: "¿Cuál es la capital de Francia?", respuestas: ["Berlín", "Madrid", "París", "Roma"], correcta: 2 },
      { id: 2, texto: "¿Cuántos planetas hay en el sistema solar?", respuestas: ["8", "9", "7", "10"], correcta: 0 },
      { id: 3, texto: "¿Quién escribió 'Don Quijote'?", respuestas: ["García Márquez", "Cervantes", "Borges", "Lorca"], correcta: 1 },
      { id: 4, texto: "¿Cuál es el río más largo del mundo?", respuestas: ["Amazonas", "Nilo", "Yangtsé", "Misisipi"], correcta: 0 },
      { id: 5, texto: "¿Qué país inventó la pasta?", respuestas: ["Italia", "China", "Japón", "India"], correcta: 1 },
      { id: 6, texto: "¿Cuál es el idioma más hablado en el mundo?", respuestas: ["Inglés", "Mandarín", "Español", "Hindú"], correcta: 1 },
      { id: 7, texto: "¿Qué animal es conocido como 'el rey de la selva'?", respuestas: ["Tigre", "Elefante", "León", "Jirafa"], correcta: 2 },
      { id: 8, texto: "¿En qué año llegó el hombre a la luna?", respuestas: ["1969", "1972", "1965", "1970"], correcta: 0 },
      { id: 9, texto: "¿Qué gas respiramos los seres humanos?", respuestas: ["Hidrógeno", "Oxígeno", "Dióxido de carbono", "Nitrógeno"], correcta: 1 },
      { id: 10, texto: "¿Cuál es el océano más grande del mundo?", respuestas: ["Atlántico", "Pacífico", "Índico", "Ártico"], correcta: 1 }
    ];

    // Mostrar el usuario logueado
    function mostrarUsuario() {
      const userName = localStorage.getItem('userName');
      const userInfoDiv = document.getElementById('user-info');

      if (!userName) {
        alert("No has iniciado sesión. Redirigiendo al login...");
        window.location.href = 'index.html'; // Redirigir al login si no hay usuario
      } else {
        userInfoDiv.innerHTML = `Usuario: <strong>${userName}</strong> <button onclick="logout()">Cerrar sesión</button>`;
      }
    }

    function logout() {
      localStorage.removeItem('userName');
      window.location.href = 'index.html'; // Redirigir al login al cerrar sesión
    }

    // Cargar el cuestionario con desbloqueo progresivo
    function cargarCuestionario() {
      const cuestionarioDiv = document.getElementById('cuestionario');

      preguntas.forEach((pregunta, index) => {
        const preguntaDiv = document.createElement('div');
        preguntaDiv.id = `pregunta-${pregunta.id}`;
        preguntaDiv.classList.add('pregunta');
        preguntaDiv.style.display = index === 0 ? 'block' : 'none'; // Solo mostrar la primera pregunta inicialmente

        preguntaDiv.innerHTML = `
          <h2>Pregunta ${pregunta.id}</h2>
          <p>${pregunta.texto}</p>
          <div class="respuestas">
            ${pregunta.respuestas.map((respuesta, i) => `
              <button 
                class="respuesta-btn" 
                onclick="enviarRespuesta(${pregunta.id}, ${i}, ${index})">
                ${respuesta}
              </button>
            `).join('')}
          </div>
        `;

        cuestionarioDiv.appendChild(preguntaDiv);
      });
    }

    // Enviar la respuesta
    function enviarRespuesta(idPregunta, idRespuesta, index) {
      const usuario = localStorage.getItem('userName');
      const carta = groupConfig.users.find(u => u.name === usuario)?.carta || "Sin carta";

      if (!usuario) {
        alert("No has iniciado sesión. Redirigiendo al login...");
        window.location.href = 'index.html';
        return;
      }

      const correcta = preguntas[index].correcta === idRespuesta;
      const feedbackDiv = document.getElementById('feedback');
      feedbackDiv.innerHTML = correcta 
        ? `<p style="color: lime;">¡Correcto!</p>` 
        : `<p style="color: red;">Respuesta incorrecta.</p>`;

      // Enviar datos al API
      fetch('https://678aba6fdd587da7ac2b3c2b.mockapi.io/api/respuestas', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          usuario,
          carta,
          idPregunta,
          idRespuesta,
          correcta
        })
      });

      // Desbloquear la siguiente pregunta
      if (correcta) {
        const preguntaActual = document.getElementById(`pregunta-${idPregunta}`);
        const siguientePregunta = document.getElementById(`pregunta-${idPregunta + 1}`);
        if (preguntaActual) preguntaActual.style.display = 'none';
        if (siguientePregunta) siguientePregunta.style.display = 'block';
      }
    }

    // Iniciar la página
    window.onload = () => {
      mostrarUsuario();
      cargarCuestionario();
    };
  </script>

  <style>
    .pregunta { margin: 20px 0; }
    .respuesta-btn {
      display: block;
      width: 100%;
      margin: 10px 0;
      padding: 15px;
      font-size: 1.2rem;
      background-color: #007BFF;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      text-align: left;
    }
    .respuesta-btn:hover {
      background-color: #0056b3;
    }
    .respuesta-btn:active {
      background-color: #003d7a;
    }
  </style>
</body>
</html>
